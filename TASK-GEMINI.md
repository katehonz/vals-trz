# Задача: МОД (Минимален Осигурителен Доход) — страница и seed данни 2026

Управление на минималните осигурителни доходи по икономическа дейност (КИД) и квалификационна група на персонала (1–9 по НКПД).

## Контекст

- Java 21 + Spring Boot 3.4.2, React + TypeScript + Vite 6, ArangoDB 3.12
- JWT auth активен — `authHeaders()` в `apiClient.ts`
- Multi-tenant: всички ентитети имат `tenantId`; `Company.id` = tenantId
- API pattern: `/api/companies/{tenantId}/resource`
- CORS разрешени методи: GET, POST, PUT, PATCH, DELETE, OPTIONS
- Вече съществува `InsuranceThreshold` entity (`insuranceThresholds` колекция) с полета: `year`, `nkidCode`, `personnelGroup`, `nkpdCode`, `minInsurableIncome`
- Вече съществува `InsuranceThresholdRepository` с методи: `findByTenantIdAndYear`, `findByTenantIdAndYearAndPersonnelGroup`, `findByTenantIdAndYearAndNkidCodeAndPersonnelGroup`
- Вече съществуват КИД кодове (4-цифрени, напр. "62.10") в `EconomicActivity` entity, заредени за фирмата с `active` флаг
- НЯМА controller за InsuranceThreshold
- НЯМА frontend страница за МОД
- CSS класове: `.data-table`, `.toolbar`, `.form-grid`, `.btn-success`, `.btn-small`, `.page`
- Пример за API клиент в `frontend/src/api/apiClient.ts` — виж `tenantApi<T>()` factory pattern
- Пример за seed метод — виж `InsuranceService.seedContributions()` и `seedEconomicActivities()`
- Колекцията `insuranceThresholds` се създава автоматично от `ArangoCollectionInitializer`

## Какво е МОД

Минималният осигурителен доход (МОД) е минималната сума, върху която се дължат осигурителни вноски за конкретен работник. Определя се от:
1. **КИД код** на дейността (4-цифрен, напр. 62.10)
2. **Квалификационна група** по НКПД (1–9)

Ако заплатата е по-висока от МОД, осигуровките се начисляват върху реалната заплата.
Ако заплатата е по-ниска от МОД, осигуровките се начисляват върху МОД.

Данните се публикуват ежегодно в Приложение 1 към ЗБДОО (Закон за бюджета на ДОО).

## Подзадача А: Backend Controller

### 1. Създай `InsuranceThresholdController.java`

Файл: `backend/src/main/java/com/valstrz/controller/InsuranceThresholdController.java`

```java
@PreAuthorize("hasAnyRole('ADMIN','ACCOUNTANT')")
@RestController
@RequestMapping("/api/companies/{tenantId}/insurance-thresholds")
```

Endpoints:
- `GET ?year=2026` — всички МОД за годината
- `GET ?year=2026&personnelGroup=5` — МОД за конкретна група
- `GET /{id}` — по id
- `POST` — ръчно добавяне
- `PUT /{id}` — редакция
- `DELETE /{id}` — изтриване
- `POST /seed?year=2026` — зарежда МОД за 2026 г. (виж Подзадача Б)

### 2. Seed метод в InsuranceService

Добави метод `seedInsuranceThresholds(String tenantId, int year)` в `InsuranceService.java`.

**МОД 2026** (Приложение 1 към ЗБДОО за 2026):

За всеки КИД код (2-цифрен раздел, напр. "01", "62") има 9 групи персонал.
Ако за даден КИД код няма специфичен МОД → използва се МРЗ (933 лв за 2026).

Ето основните МОД стойности за 2026 по **раздел КИД** (2-цифрен) и **група НКПД** (1–9):

```
Раздел | Гр.1  | Гр.2  | Гр.3  | Гр.4  | Гр.5  | Гр.6  | Гр.7  | Гр.8  | Гр.9
01     | 1300  | 1070  | 1020  |  975  |  933  |  933  |  933  |  933  |  933
02     | 1350  | 1100  | 1030  |  990  |  933  |  933  |  933  |  933  |  933
03     | 1250  | 1050  | 1000  |  960  |  933  |  933  |  933  |  933  |  933
05-09  | 1600  | 1300  | 1200  | 1100  | 1050  | 1000  |  980  |  960  |  933
10-12  | 1400  | 1150  | 1080  | 1030  |  980  |  960  |  940  |  933  |  933
13-15  | 1300  | 1080  | 1020  |  975  |  933  |  933  |  933  |  933  |  933
16     | 1350  | 1120  | 1050  | 1000  |  960  |  940  |  933  |  933  |  933
17-18  | 1350  | 1100  | 1030  |  990  |  950  |  933  |  933  |  933  |  933
19     | 1500  | 1200  | 1120  | 1060  | 1000  |  970  |  950  |  940  |  933
20     | 1500  | 1220  | 1130  | 1070  | 1010  |  980  |  960  |  940  |  933
21     | 1700  | 1400  | 1250  | 1150  | 1080  | 1030  | 1000  |  970  |  933
22     | 1400  | 1150  | 1070  | 1020  |  975  |  950  |  933  |  933  |  933
23     | 1350  | 1100  | 1040  | 1000  |  960  |  940  |  933  |  933  |  933
24     | 1550  | 1250  | 1150  | 1080  | 1020  |  980  |  960  |  940  |  933
25     | 1400  | 1130  | 1060  | 1010  |  970  |  940  |  933  |  933  |  933
26     | 1550  | 1280  | 1180  | 1100  | 1040  | 1000  |  970  |  950  |  933
27     | 1450  | 1180  | 1100  | 1050  | 1000  |  970  |  950  |  933  |  933
28     | 1400  | 1150  | 1070  | 1020  |  975  |  950  |  933  |  933  |  933
29-30  | 1500  | 1200  | 1120  | 1060  | 1000  |  970  |  950  |  940  |  933
31     | 1400  | 1150  | 1080  | 1030  |  980  |  960  |  940  |  933  |  933
32     | 1300  | 1080  | 1020  |  980  |  940  |  933  |  933  |  933  |  933
33     | 1400  | 1150  | 1070  | 1020  |  975  |  950  |  933  |  933  |  933
35     | 1600  | 1300  | 1200  | 1100  | 1050  | 1000  |  980  |  960  |  933
36     | 1400  | 1150  | 1070  | 1020  |  975  |  950  |  933  |  933  |  933
37-39  | 1300  | 1080  | 1020  |  975  |  933  |  933  |  933  |  933  |  933
41-43  | 1400  | 1150  | 1080  | 1030  |  975  |  950  |  933  |  933  |  933
45     | 1350  | 1100  | 1040  | 1000  |  960  |  933  |  933  |  933  |  933
46     | 1400  | 1150  | 1070  | 1020  |  975  |  950  |  933  |  933  |  933
47     | 1300  | 1080  | 1020  |  975  |  933  |  933  |  933  |  933  |  933
49     | 1400  | 1150  | 1080  | 1030  |  980  |  960  |  940  |  933  |  933
50     | 1500  | 1200  | 1120  | 1060  | 1000  |  970  |  950  |  940  |  933
51     | 1700  | 1400  | 1250  | 1150  | 1080  | 1030  | 1000  |  970  |  933
52     | 1350  | 1100  | 1040  | 1000  |  960  |  933  |  933  |  933  |  933
53     | 1300  | 1080  | 1020  |  975  |  933  |  933  |  933  |  933  |  933
55-56  | 1300  | 1080  | 1020  |  975  |  933  |  933  |  933  |  933  |  933
58     | 1450  | 1200  | 1100  | 1050  | 1000  |  970  |  940  |  933  |  933
59-60  | 1400  | 1150  | 1070  | 1020  |  975  |  950  |  933  |  933  |  933
61     | 1700  | 1400  | 1250  | 1150  | 1080  | 1030  | 1000  |  970  |  933
62     | 1700  | 1400  | 1250  | 1150  | 1080  | 1030  | 1000  |  970  |  933
63     | 1500  | 1220  | 1130  | 1070  | 1010  |  980  |  960  |  940  |  933
64     | 1900  | 1550  | 1400  | 1250  | 1150  | 1080  | 1030  | 1000  |  933
65     | 1800  | 1500  | 1350  | 1200  | 1100  | 1050  | 1010  |  980  |  933
66     | 1600  | 1300  | 1200  | 1100  | 1050  | 1000  |  980  |  960  |  933
68     | 1400  | 1150  | 1080  | 1030  |  980  |  960  |  940  |  933  |  933
69     | 1500  | 1220  | 1130  | 1070  | 1010  |  980  |  960  |  940  |  933
70     | 1500  | 1220  | 1130  | 1070  | 1010  |  980  |  960  |  940  |  933
71     | 1500  | 1200  | 1100  | 1050  | 1000  |  970  |  940  |  933  |  933
72     | 1600  | 1300  | 1200  | 1100  | 1050  | 1000  |  980  |  960  |  933
73     | 1400  | 1150  | 1070  | 1020  |  975  |  950  |  933  |  933  |  933
74     | 1400  | 1150  | 1070  | 1020  |  975  |  950  |  933  |  933  |  933
75     | 1350  | 1100  | 1040  | 1000  |  960  |  933  |  933  |  933  |  933
77     | 1350  | 1100  | 1040  | 1000  |  960  |  933  |  933  |  933  |  933
78     | 1400  | 1150  | 1080  | 1030  |  980  |  960  |  940  |  933  |  933
79     | 1350  | 1100  | 1040  | 1000  |  960  |  933  |  933  |  933  |  933
80     | 1350  | 1100  | 1040  | 1000  |  960  |  933  |  933  |  933  |  933
81     | 1300  | 1080  | 1020  |  975  |  933  |  933  |  933  |  933  |  933
82     | 1500  | 1200  | 1100  | 1050  | 1000  |  970  |  940  |  933  |  933
84     | 1500  | 1220  | 1130  | 1070  | 1010  |  980  |  960  |  940  |  933
85     | 1500  | 1200  | 1100  | 1050  | 1000  |  970  |  940  |  933  |  933
86     | 1600  | 1300  | 1200  | 1100  | 1050  | 1000  |  980  |  960  |  933
87     | 1300  | 1080  | 1020  |  975  |  933  |  933  |  933  |  933  |  933
88     | 1300  | 1080  | 1020  |  975  |  933  |  933  |  933  |  933  |  933
90     | 1350  | 1100  | 1040  | 1000  |  960  |  933  |  933  |  933  |  933
91     | 1300  | 1080  | 1020  |  975  |  933  |  933  |  933  |  933  |  933
92     | 1300  | 1080  | 1020  |  975  |  933  |  933  |  933  |  933  |  933
93     | 1300  | 1080  | 1020  |  975  |  933  |  933  |  933  |  933  |  933
94     | 1300  | 1080  | 1020  |  975  |  933  |  933  |  933  |  933  |  933
95     | 1350  | 1100  | 1040  | 1000  |  960  |  933  |  933  |  933  |  933
96     | 1300  | 1080  | 1020  |  975  |  933  |  933  |  933  |  933  |  933
97     | 1250  | 1050  | 1000  |  960  |  933  |  933  |  933  |  933  |  933
```

**Важно за seed**: Полето `nkidCode` в InsuranceThreshold е 2-цифрен раздел (напр. "62"), НЕ пълен 4-цифрен КИД код. За раздели с диапазон (напр. "05-09") — създай отделен запис за всеки раздел (05, 06, 07, 08, 09).

## Подзадача Б: Frontend страница

### 1. API клиент

Добави в `frontend/src/api/apiClient.ts`:

```typescript
export const insuranceThresholdApi = {
  ...tenantApi<any>('insurance-thresholds'),
  seed: (tenantId: string, year: number) =>
    request<any[]>(`/companies/${tenantId}/insurance-thresholds/seed?year=${year}`, { method: 'POST' }),
};
```

### 2. Нова страница `InsuranceThresholdsPage.tsx`

Файл: `frontend/src/pages/InsuranceThresholdsPage.tsx`

Функционалност:
- Селектор за година
- Бутон "Зареди МОД за {year} г." (seed)
- Търсачка (филтър по КИД код или група)
- Таблица: Раздел КИД | Гр.1 | Гр.2 | Гр.3 | Гр.4 | Гр.5 | Гр.6 | Гр.7 | Гр.8 | Гр.9
  - Всеки ред е 1 КИД раздел, колоните са 9-те групи, стойностите са МОД в лв.
  - Стойностите > МРЗ (933) да са **bold**
  - Стойностите == МРЗ (933) да са сиви
- Кликване на клетка → инлайн редакция на стойността
- Брояч: "Общо: X раздела"

### 3. Routing и Sidebar

- Route: `/settings/insurance-thresholds` → `InsuranceThresholdsPage`
- Sidebar: ново меню "МОД" в група "Данни и настройки", под "Осигурителни вноски"

## Подзадача В: Интеграция в Employment формата

В `EmployeeDetailPage.tsx` → EmploymentDetailForm:

Когато потребителят избере КИД код и група персонал (`personnelGroup`), покажи информативно полето с текущия МОД за тази комбинация. Нещо като:
```
МОД: 1,700.00 лв. (КИД 62, Група 1)
```

Това е read-only, информативно — зарежда се от `insuranceThresholdApi`.

## ВАЖНО

- Използвай стандартни кавички `"` в Java код, НЕ smart quotes `""`
- Провери дали компилира: `cd backend && mvn compile -q` и `cd frontend && npx vite build`
- Без стрелки в number inputs (spinner arrows) — `input[type=number] { -webkit-appearance: none; -moz-appearance: textfield; }`
- `InsuranceThreshold` entity вече съществува — НЕ го създавай наново
- `InsuranceThresholdRepository` вече съществува — НЕ го създавай наново
- Колекцията `insuranceThresholds` вече е в `ArangoCollectionInitializer` — НЕ я добавяй пак
- Seed данните са примерни/приблизителни — важното е структурата, потребителят после ги коригира
