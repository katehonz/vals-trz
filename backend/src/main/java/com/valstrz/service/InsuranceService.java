package com.valstrz.service;

import com.valstrz.entity.insurance.InsuranceContributions;
import com.valstrz.entity.insurance.InsuranceThreshold;
import com.valstrz.entity.nomenclature.EconomicActivity;
import com.valstrz.repository.EconomicActivityRepository;
import com.valstrz.repository.InsuranceContributionsRepository;
import com.valstrz.repository.InsuranceThresholdRepository;
import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.math.BigDecimal;
import java.nio.charset.StandardCharsets;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.stream.StreamSupport;

@Service
public class InsuranceService {

    private final EconomicActivityRepository economicActivityRepository;
    private final InsuranceContributionsRepository contributionsRepository;
    private final InsuranceThresholdRepository thresholdRepository;

    public InsuranceService(EconomicActivityRepository economicActivityRepository,
                            InsuranceContributionsRepository contributionsRepository,
                            InsuranceThresholdRepository thresholdRepository) {
        this.economicActivityRepository = economicActivityRepository;
        this.contributionsRepository = contributionsRepository;
        this.thresholdRepository = thresholdRepository;
    }

    /**
     * Зарежда стандартните осигурителни проценти за 2026 г.
     * Видове осигурени: 01 (стандартен), 12 (самоосигуряващ се)
     */

    /**
     * Зарежда стандартните МОД за 2026 г. директно в ЕВРО.
     * Данни от https://kik-info.com/spravochnik/mod/ (Приложение 1 към ЗБДОО).
     * МРЗ 2026 = 550.66 EUR. Повечето позиции = МРЗ, само няколко имат по-висок МОД.
     */
    public List<InsuranceThreshold> seedInsuranceThresholds(String tenantId, int year) {
        List<InsuranceThreshold> existing = StreamSupport.stream(
                thresholdRepository.findByTenantIdAndYear(tenantId, year).spliterator(), false).toList();
        if (!existing.isEmpty()) return existing;

        List<InsuranceThreshold> result = new ArrayList<>();
        final String M = "550.66"; // МРЗ в EUR

        // МОД стойности директно в EUR от kik-info.com
        // {nkidCode, група1, група2, група3, група4, група5, група6, група7, група8, група9}
        String[][] data = {
            // Ред 1-12: Земеделие, горско, рибно, добив (01-09) — всички МРЗ
            {"01", M, M, M, M, M, M, M, M, M},
            {"02", M, M, M, M, M, M, M, M, M},
            {"03", M, M, M, M, M, M, M, M, M},
            {"05", M, M, M, M, M, M, M, M, M},
            {"06", M, M, M, M, M, M, M, M, M},
            {"07", M, M, M, M, M, M, M, M, M},
            {"08", M, M, M, M, M, M, M, M, M},
            {"09", M, M, M, M, M, M, M, M, M},
            // Ред 13-14: Месо, риба — по-висок МОД за група 1
            {"10.1", "759.78", M, M, M, M, M, M, M, M},
            {"10.2", "759.78", M, M, M, M, M, M, M, M},
            {"10.12", "626.84", M, M, M, M, M, M, M, M},
            // Ред 15-19: Храни — повечето МРЗ
            {"10.3", M, M, M, M, M, M, M, M, M},
            {"10.4", M, M, M, M, M, M, M, M, M},
            {"10.5", M, M, M, M, M, M, M, M, M},
            {"10.6", "637.58", M, M, M, M, M, M, M, M},
            {"10.7", M, M, M, M, M, M, M, M, M},
            {"10.8", M, M, M, M, M, M, M, M, M},
            {"10.81", "584.41", M, M, M, M, M, M, M, M},
            {"10.82", "584.41", M, M, M, M, M, M, M, M},
            {"10.9", "573.67", M, M, M, M, M, M, M, M},
            // Ред 22-24: Напитки
            {"11", M, M, M, M, M, M, M, M, M},
            // Ред 25-32: Производство (12-18, 58, 59) — всички МРЗ
            {"12", M, M, M, M, M, M, M, M, M},
            {"13", M, M, M, M, M, M, M, M, M},
            {"14", M, M, M, M, M, M, M, M, M},
            {"15", M, M, M, M, M, M, M, M, M},
            {"16", M, M, M, M, M, M, M, M, M},
            {"17", M, M, M, M, M, M, M, M, M},
            {"18", M, M, M, M, M, M, M, M, M},
            {"58", M, M, M, M, M, M, M, M, M},
            {"59", M, M, M, M, M, M, M, M, M},
            // Ред 33: Кокс и нефт — висок МОД за група 1 и 2
            {"19", "901.41", "669.79", M, M, M, M, M, M, M},
            // Ред 34-48: Производство (20-33) — всички МРЗ
            {"20", M, M, M, M, M, M, M, M, M},
            {"21", M, M, M, M, M, M, M, M, M},
            {"22", M, M, M, M, M, M, M, M, M},
            {"23", M, M, M, M, M, M, M, M, M},
            {"24", M, M, M, M, M, M, M, M, M},
            {"25", M, M, M, M, M, M, M, M, M},
            {"26", M, M, M, M, M, M, M, M, M},
            {"27", M, M, M, M, M, M, M, M, M},
            {"28", M, M, M, M, M, M, M, M, M},
            {"29", M, M, M, M, M, M, M, M, M},
            {"30", M, M, M, M, M, M, M, M, M},
            {"31", M, M, M, M, M, M, M, M, M},
            {"32", M, M, M, M, M, M, M, M, M},
            {"33", M, M, M, M, M, M, M, M, M},
            // Ред 49-51: Енергия (35) — газ и тръбопровод по-висок
            {"35.1", M, M, M, M, M, M, M, M, M},
            {"35.2", "747.00", M, M, M, M, M, M, M, M},
            {"35.3", M, M, M, M, M, M, M, M, M},
            // Ред 52-57: Води, отпадъци, строителство (36-43) — всички МРЗ
            {"36", M, M, M, M, M, M, M, M, M},
            {"37", M, M, M, M, M, M, M, M, M},
            {"38", M, M, M, M, M, M, M, M, M},
            {"39", M, M, M, M, M, M, M, M, M},
            {"41", M, M, M, M, M, M, M, M, M},
            {"42", M, M, M, M, M, M, M, M, M},
            {"43", M, M, M, M, M, M, M, M, M},
            {"45", M, M, M, M, M, M, M, M, M},
            // Ред 58: Търговия — по-висок МОД за група 1
            {"46", "664.17", M, M, M, M, M, M, M, M},
            {"47", "664.17", M, M, M, M, M, M, M, M},
            // Ред 59-60: Фармация, туризъм — МРЗ
            {"79", M, M, M, M, M, M, M, M, M},
            // Ред 61: Хотели, ресторанти — по-висок за група 1 и 2
            {"55", "647.30", "557.31", M, M, M, M, M, M, M},
            {"56", "647.30", "557.31", M, M, M, M, M, M, M},
            // Ред 62-67: Транспорт (49-53) — повечето МРЗ
            {"49.1", M, M, M, M, M, M, M, M, M},
            {"49.2", M, M, M, M, M, M, M, M, M},
            {"49.3", M, M, M, M, M, M, M, M, M},
            {"49.4", M, M, M, M, M, M, M, M, M},
            {"49.5", "747.00", M, M, M, M, M, M, M, M},
            {"50", M, M, M, M, M, M, M, M, M},
            {"51", "614.06", "563.95", M, M, M, M, M, M, M},
            {"52", M, M, M, M, M, M, M, M, M},
            {"53", M, M, M, M, M, M, M, M, M},
            // Ред 68: Телеком, медии
            {"60", M, M, M, M, M, M, M, M, M},
            {"61", M, M, M, M, M, M, M, M, M},
            // Ред 69: Финанси — висок МОД за група 1
            {"64", "812.44", M, M, M, M, M, M, M, M},
            {"65", "812.44", M, M, M, M, M, M, M, M},
            {"66", "812.44", M, M, M, M, M, M, M, M},
            // Ред 70: ИТ, недвижими имоти, услуги — всички МРЗ
            {"62", M, M, M, M, M, M, M, M, M},
            {"63", M, M, M, M, M, M, M, M, M},
            {"68", M, M, M, M, M, M, M, M, M},
            {"69", M, M, M, M, M, M, M, M, M},
            {"70", M, M, M, M, M, M, M, M, M},
            {"71", M, M, M, M, M, M, M, M, M},
            {"73", M, M, M, M, M, M, M, M, M},
            {"74", M, M, M, M, M, M, M, M, M},
            {"77", M, M, M, M, M, M, M, M, M},
            {"78", M, M, M, M, M, M, M, M, M},
            {"81", M, M, M, M, M, M, M, M, M},
            {"82", M, M, M, M, M, M, M, M, M},
            // Ред 71-74: Охрана, наука, държава, образование
            {"80", M, M, M, M, M, M, M, M, M},
            {"72", M, M, M, M, M, M, M, M, M},
            {"84", M, M, M, M, M, M, M, M, M},
            {"85", M, M, M, M, M, M, M, M, M},
            // Ред 75-77: Здравеопазване, социални
            {"75", M, M, M, M, M, M, M, M, M},
            {"86", M, M, M, M, M, M, M, M, M},
            {"86.1", "683.09", M, M, M, M, M, M, M, M},
            {"87", M, M, M, M, M, M, M, M, M},
            {"88", M, M, M, M, M, M, M, M, M},
            // Ред 78-80: Култура, спорт, организации
            {"90", M, M, M, M, M, M, M, M, M},
            {"91", M, M, M, M, M, M, M, M, M},
            {"92", M, M, M, M, M, M, M, M, M},
            {"93", M, M, M, M, M, M, M, M, M},
            {"94", M, M, M, M, M, M, M, M, M},
            {"95", M, M, M, M, M, M, M, M, M},
            {"96", M, M, M, M, M, M, M, M, M},
            {"97", M, M, M, M, M, M, M, M, M},
            {"99", M, M, M, M, M, M, M, M, M},
        };

        for (String[] row : data) {
            String nkidCode = row[0];
            for (int group = 1; group <= 9; group++) {
                InsuranceThreshold t = new InsuranceThreshold();
                t.setTenantId(tenantId);
                t.setYear(year);
                t.setNkidCode(nkidCode);
                t.setPersonnelGroup(group);
                t.setMinInsurableIncome(new BigDecimal(row[group]));
                result.add(thresholdRepository.save(t));
            }
        }
        return result;
    }

    public List<InsuranceContributions> seedContributions(String tenantId, int year) {
        List<InsuranceContributions> existing = StreamSupport.stream(
                contributionsRepository.findByTenantIdAndYear(tenantId, year).spliterator(), false).toList();
        if (!existing.isEmpty()) return existing;

        List<InsuranceContributions> records = new ArrayList<>();

        // Вид 01 - трета категория, стандартен трудов договор
        // Преди 01.01.1960 (без ДЗПО)
        records.add(buildContributions(tenantId, year, "before1960", "01",
                "11.02", "8.78",   // пенсия
                "2.10", "1.40",    // ОЗМ
                "0.60", "0.40",    // безработица
                null, null,        // ДЗПО
                "4.80", "3.20",    // здравно
                "0.40",            // ТЗПБ
                null, null));      // ППФ, учителски

        // След 31.12.1959 (с ДЗПО-УПФ 5%)
        records.add(buildContributions(tenantId, year, "after1960", "01",
                "8.22", "6.58",    // пенсия
                "2.10", "1.40",    // ОЗМ
                "0.60", "0.40",    // безработица
                "2.80", "2.20",    // ДЗПО-УПФ
                "4.80", "3.20",    // здравно
                "0.40",            // ТЗПБ
                null, null));      // ППФ, учителски

        // Вид 12 - самоосигуряващо се лице (всичко плаща лицето)
        records.add(buildContributions(tenantId, year, "before1960", "12",
                "0", "19.80",      // пенсия (цялата за лицето)
                "0", "3.50",       // ОЗМ
                "0", "0",          // без безработица
                null, null,        // ДЗПО
                "0", "8.00",       // здравно (цялото за лицето)
                "0",               // ТЗПБ
                null, null));

        records.add(buildContributions(tenantId, year, "after1960", "12",
                "0", "14.80",      // пенсия
                "0", "3.50",       // ОЗМ
                "0", "0",          // без безработица
                "0", "5.00",       // ДЗПО-УПФ (цялото за лицето)
                "0", "8.00",       // здравно
                "0",               // ТЗПБ
                null, null));

        return records.stream().map(contributionsRepository::save).toList();
    }

    private InsuranceContributions buildContributions(String tenantId, int year, String category, String insuredType,
                                                       String pensionEr, String pensionEe,
                                                       String sicknessEr, String sicknessEe,
                                                       String unemplEr, String unemplEe,
                                                       String dzpoEr, String dzpoEe,
                                                       String healthEr, String healthEe,
                                                       String tzpb,
                                                       String profPensionEr, String teacherPensionEr) {
        InsuranceContributions c = new InsuranceContributions();
        c.setTenantId(tenantId);
        c.setYear(year);
        c.setCategory(category);
        c.setInsuredType(insuredType);
        c.setPensionEmployer(new BigDecimal(pensionEr));
        c.setPensionEmployee(new BigDecimal(pensionEe));
        c.setSicknessEmployer(new BigDecimal(sicknessEr));
        c.setSicknessEmployee(new BigDecimal(sicknessEe));
        c.setUnemploymentEmployer(new BigDecimal(unemplEr));
        c.setUnemploymentEmployee(new BigDecimal(unemplEe));
        c.setSupplementaryPensionEmployer(dzpoEr != null ? new BigDecimal(dzpoEr) : BigDecimal.ZERO);
        c.setSupplementaryPensionEmployee(dzpoEe != null ? new BigDecimal(dzpoEe) : BigDecimal.ZERO);
        c.setHealthEmployer(new BigDecimal(healthEr));
        c.setHealthEmployee(new BigDecimal(healthEe));
        c.setWorkAccidentEmployer(new BigDecimal(tzpb));
        c.setProfessionalPensionEmployer(profPensionEr != null ? new BigDecimal(profPensionEr) : null);
        c.setTeacherPensionEmployer(teacherPensionEr != null ? new BigDecimal(teacherPensionEr) : null);
        return c;
    }

    /**
     * ТЗПБ проценти по раздел (2-цифрен КИД код) — от kik-info.com/spravochnik/tzpb/
     */
    private static final Map<String, String> TZPB_BY_DIVISION = new HashMap<>();
    static {
        TZPB_BY_DIVISION.put("01","0.9"); TZPB_BY_DIVISION.put("02","1.1"); TZPB_BY_DIVISION.put("03","0.7");
        TZPB_BY_DIVISION.put("05","1.1"); TZPB_BY_DIVISION.put("06","0.7"); TZPB_BY_DIVISION.put("07","1.1");
        TZPB_BY_DIVISION.put("08","1.1"); TZPB_BY_DIVISION.put("09","1.1"); TZPB_BY_DIVISION.put("10","0.7");
        TZPB_BY_DIVISION.put("11","0.7"); TZPB_BY_DIVISION.put("12","1.1"); TZPB_BY_DIVISION.put("13","1.1");
        TZPB_BY_DIVISION.put("14","0.5"); TZPB_BY_DIVISION.put("15","0.5"); TZPB_BY_DIVISION.put("16","1.1");
        TZPB_BY_DIVISION.put("17","1.1"); TZPB_BY_DIVISION.put("18","0.5"); TZPB_BY_DIVISION.put("19","0.9");
        TZPB_BY_DIVISION.put("20","1.1"); TZPB_BY_DIVISION.put("21","0.9"); TZPB_BY_DIVISION.put("22","1.1");
        TZPB_BY_DIVISION.put("23","1.1"); TZPB_BY_DIVISION.put("24","1.1"); TZPB_BY_DIVISION.put("25","1.1");
        TZPB_BY_DIVISION.put("26","0.5"); TZPB_BY_DIVISION.put("27","0.7"); TZPB_BY_DIVISION.put("28","0.9");
        TZPB_BY_DIVISION.put("29","0.5"); TZPB_BY_DIVISION.put("30","1.1"); TZPB_BY_DIVISION.put("31","1.1");
        TZPB_BY_DIVISION.put("32","0.7"); TZPB_BY_DIVISION.put("33","1.1"); TZPB_BY_DIVISION.put("35","0.9");
        TZPB_BY_DIVISION.put("36","0.9"); TZPB_BY_DIVISION.put("37","1.1"); TZPB_BY_DIVISION.put("38","1.1");
        TZPB_BY_DIVISION.put("39","1.1"); TZPB_BY_DIVISION.put("41","1.1"); TZPB_BY_DIVISION.put("42","1.1");
        TZPB_BY_DIVISION.put("43","1.1"); TZPB_BY_DIVISION.put("46","0.5"); TZPB_BY_DIVISION.put("47","0.5");
        TZPB_BY_DIVISION.put("49","1.1"); TZPB_BY_DIVISION.put("50","1.1"); TZPB_BY_DIVISION.put("51","0.7");
        TZPB_BY_DIVISION.put("52","1.1"); TZPB_BY_DIVISION.put("53","0.7"); TZPB_BY_DIVISION.put("55","0.5");
        TZPB_BY_DIVISION.put("56","0.5"); TZPB_BY_DIVISION.put("58","0.4"); TZPB_BY_DIVISION.put("59","0.4");
        TZPB_BY_DIVISION.put("60","0.4"); TZPB_BY_DIVISION.put("61","0.7"); TZPB_BY_DIVISION.put("62","0.4");
        TZPB_BY_DIVISION.put("63","0.4"); TZPB_BY_DIVISION.put("64","0.4"); TZPB_BY_DIVISION.put("65","0.4");
        TZPB_BY_DIVISION.put("66","0.4"); TZPB_BY_DIVISION.put("68","1.1"); TZPB_BY_DIVISION.put("69","0.4");
        TZPB_BY_DIVISION.put("70","0.5"); TZPB_BY_DIVISION.put("71","0.7"); TZPB_BY_DIVISION.put("72","0.5");
        TZPB_BY_DIVISION.put("73","0.4"); TZPB_BY_DIVISION.put("74","0.5"); TZPB_BY_DIVISION.put("75","0.4");
        TZPB_BY_DIVISION.put("77","1.1"); TZPB_BY_DIVISION.put("78","0.5"); TZPB_BY_DIVISION.put("79","0.5");
        TZPB_BY_DIVISION.put("80","0.7"); TZPB_BY_DIVISION.put("81","0.9"); TZPB_BY_DIVISION.put("82","0.4");
        TZPB_BY_DIVISION.put("84","0.7"); TZPB_BY_DIVISION.put("85","0.5"); TZPB_BY_DIVISION.put("86","0.5");
        TZPB_BY_DIVISION.put("87","0.5"); TZPB_BY_DIVISION.put("88","0.5"); TZPB_BY_DIVISION.put("90","0.7");
        TZPB_BY_DIVISION.put("91","0.5"); TZPB_BY_DIVISION.put("92","0.5"); TZPB_BY_DIVISION.put("93","0.5");
        TZPB_BY_DIVISION.put("94","0.4"); TZPB_BY_DIVISION.put("95","0.5"); TZPB_BY_DIVISION.put("96","0.4");
        TZPB_BY_DIVISION.put("97","0.4"); TZPB_BY_DIVISION.put("98","0.4"); TZPB_BY_DIVISION.put("99","0.5");
    }

    /**
     * Връща ТЗПБ процент по КИД код (с или без точка).
     */
    public static BigDecimal getTzpbByKidCode(String kidCode) {
        if (kidCode == null) return null;
        String division = kidCode.replace(".", "");
        if (division.length() >= 2) division = division.substring(0, 2);
        String pct = TZPB_BY_DIVISION.get(division);
        return pct != null ? new BigDecimal(pct) : null;
    }

    /**
     * За НАП Декларация 1 — КИД код без точка (62.10 → 6210).
     */
    public static String kidCodeForNap(String kidCode) {
        return kidCode != null ? kidCode.replace(".", "") : null;
    }

    /**
     * Зарежда КИД 2025 кодове (4-цифрени) с ТЗПБ проценти.
     * Данни от kik-info.com/spravochnik/kid/ и /tzpb/
     */
    public List<EconomicActivity> seedEconomicActivities(String tenantId, int year) {
        List<EconomicActivity> existing = StreamSupport.stream(
                economicActivityRepository.findByTenantIdAndYear(tenantId, year).spliterator(), false).toList();
        if (!existing.isEmpty()) return existing;

        // КИД код (с точка), Наименование — ТЗПБ % се определя от първите 2 цифри
        String[][] data = {
            // 01 - Растениевъдство, животновъдство и лов
            {"01.11","Отглеждане на зърнено-житни и бобови култури и маслодайни семена"},
            {"01.12","Отглеждане на ориз"},
            {"01.13","Отглеждане на зеленчуци, дини и пъпеши, кореноплодни и грудкови"},
            {"01.14","Отглеждане на захарна тръстика"},
            {"01.15","Отглеждане на тютюн"},
            {"01.16","Отглеждане на влакнодайни култури"},
            {"01.19","Отглеждане на други едногодишни култури"},
            {"01.21","Отглеждане на лозя"},
            {"01.22","Отглеждане на тропически и субтропични плодове"},
            {"01.23","Отглеждане на цитрусови плодове"},
            {"01.24","Отглеждане на семкови и костилкови плодове"},
            {"01.25","Отглеждане на черупкови, ягодоплодни и други плодове"},
            {"01.26","Отглеждане на маслосъдържащи плодове"},
            {"01.27","Отглеждане на култури за напитки"},
            {"01.28","Отглеждане на подправки, етеричномаслени и лечебни култури"},
            {"01.29","Отглеждане на други многогодишни култури"},
            {"01.30","Дейности на разсадници, без горските"},
            {"01.41","Отглеждане на едър рогат добитък, с млечно направление"},
            {"01.42","Отглеждане на едър рогат добитък, с друго направление"},
            {"01.43","Отглеждане на коне, магарета, мулета и катъри"},
            {"01.44","Отглеждане на камили, лами и подобни животни"},
            {"01.45","Отглеждане на дребен рогат добитък"},
            {"01.46","Отглеждане на свине"},
            {"01.47","Отглеждане на домашни птици"},
            {"01.48","Отглеждане на други животни"},
            {"01.50","Смесено растениевъдно-животновъдно стопанство"},
            {"01.61","Спомагателни дейности в растениевъдството"},
            {"01.62","Спомагателни дейности в животновъдството"},
            {"01.63","Дейности след прибиране на реколтата"},
            {"01.70","Лов и спомагателни дейности"},
            // 02 - Горско стопанство
            {"02.10","Лесовъдство и други дейности в горското стопанство"},
            {"02.20","Дърводобив"},
            {"02.30","Събиране на диворастящи и недървесни продукти"},
            {"02.40","Спомагателни дейности в горското стопанство"},
            // 03 - Рибно стопанство
            {"03.11","Океански и морски риболов"},
            {"03.12","Сладководен риболов"},
            {"03.21","Развъждане и отглеждане на риба в солени басейни"},
            {"03.22","Развъждане и отглеждане на риба в сладководни басейни"},
            {"03.30","Спомагателни дейности в рибното стопанство"},
            // 05 - Добив на въглища
            {"05.10","Добив на антрацитни и битуминозни въглища"},
            {"05.20","Добив на кафяви и лигнитни въглища"},
            // 06 - Добив на нефт и природен газ
            {"06.10","Добив на нефт"},
            {"06.20","Добив на природен газ"},
            // 07 - Добив на метални руди
            {"07.10","Добив на железни руди"},
            {"07.21","Добив на уранови и ториеви руди"},
            {"07.29","Добив на руди на цветни метали"},
            // 08 - Добив на неметални материали
            {"08.11","Добив на строителни и декоративни скални материали"},
            {"08.12","Добив на трошен камък, чакъл и пясък"},
            {"08.91","Добив на минерални суровини за химическото производство"},
            {"08.92","Добив на торф"},
            {"08.93","Добив на сол"},
            {"08.99","Добив на други неметални материали и суровини"},
            // 09 - Спомагателни дейности в добива
            {"09.10","Спомагателни дейности в добива на нефт и природен газ"},
            {"09.90","Спомагателни дейности в добива, без нефт и газ"},
            // 10 - Производство на хранителни продукти
            {"10.11","Производство и преработка на месо, без домашни птици"},
            {"10.12","Производство и преработка на месо от домашни птици"},
            {"10.13","Производство на месни продукти"},
            {"10.20","Преработка и консервиране на риба"},
            {"10.31","Преработка и консервиране на картофи"},
            {"10.32","Производство на плодови и зеленчукови сокове"},
            {"10.39","Преработка и консервиране на други плодове и зеленчуци"},
            {"10.41","Производство на растителни и животински масла и мазнини"},
            {"10.42","Производство на маргарин"},
            {"10.51","Производство на мляко и млечни продукти"},
            {"10.52","Производство на сладолед"},
            {"10.61","Производство на мелничарски продукти"},
            {"10.62","Производство на нишесте и нишестени продукти"},
            {"10.71","Производство на хляб и сладкарски изделия"},
            {"10.72","Производство на сухари и бисквити"},
            {"10.73","Производство на макарони и юфка"},
            {"10.81","Производство на захар"},
            {"10.82","Производство на какао, шоколадови и захарни изделия"},
            {"10.83","Преработка на кафе и чай"},
            {"10.84","Производство на хранителни подправки и овкусители"},
            {"10.85","Производство на готови ястия"},
            {"10.86","Производство на детски и диетични храни"},
            {"10.89","Производство на други хранителни продукти"},
            {"10.91","Производство на готови храни за селскостопански животни"},
            {"10.92","Производство на готови храни за домашни любимци"},
            // 11 - Производство на напитки
            {"11.01","Производство на спиртни напитки"},
            {"11.02","Производство на вина от грозде"},
            {"11.03","Производство на други ферментирали напитки"},
            {"11.04","Производство на други недестилирани алкохолни напитки"},
            {"11.05","Производство на пиво"},
            {"11.06","Производство на малц"},
            {"11.07","Производство на безалкохолни напитки и минерални води"},
            // 12 - Тютюневи изделия
            {"12.00","Производство на тютюневи изделия"},
            // 13 - Текстил
            {"13.10","Подготовка и предене на текстилни влакна"},
            {"13.20","Производство на тъкани"},
            {"13.30","Облагородяване на прежди, платове и облекло"},
            {"13.91","Производство на плетени платове"},
            {"13.92","Производство на домакински текстилни изделия"},
            {"13.93","Производство на килими и подови настилки"},
            {"13.94","Производство на канапи, въжета и мрежи"},
            {"13.95","Производство на нетъкани текстилни изделия"},
            {"13.96","Производство на текстилни изделия за техническа употреба"},
            {"13.99","Производство на други текстилни изделия"},
            // 14 - Облекло
            {"14.10","Производство на трикотажно и плетено облекло"},
            {"14.21","Производство на горно облекло"},
            {"14.22","Производство на долно облекло"},
            {"14.23","Производство на работно облекло"},
            {"14.24","Производство на облекло от кожи"},
            {"14.29","Производство на друго облекло"},
            // 15 - Кожи и обувки
            {"15.11","Обработка на кожи без косъм"},
            {"15.12","Производство на куфари, чанти и сарашки изделия"},
            {"15.20","Производство на обувки"},
            // 16 - Дървен материал
            {"16.11","Разкрояване и рендосване на дървен материал"},
            {"16.12","Импрегниране на дървен материал"},
            {"16.21","Производство на фурнир и дървесни плочи"},
            {"16.22","Производство на сглобени паркетни плочи"},
            {"16.23","Производство на изделия от дървен материал за строителството"},
            {"16.24","Производство на опаковки от дървен материал"},
            {"16.25","Производство на врати и прозорци от дървен материал"},
            {"16.26","Производство на твърди горива от растителна биомаса"},
            {"16.27","Довършителна обработка на изделия от дървен материал"},
            {"16.28","Производство на други изделия от дървен материал и корк"},
            // 17 - Хартия и картон
            {"17.11","Производство на влакнести полуфабрикати"},
            {"17.12","Производство на хартия и картон"},
            {"17.21","Производство на вълнообразен картон и опаковки"},
            {"17.22","Производство на санитарно-хигиенни изделия от хартия"},
            {"17.23","Производство на канцеларски материали от хартия"},
            {"17.24","Производство на тапети"},
            {"17.25","Производство на други изделия от хартия и картон"},
            // 18 - Печатна дейност
            {"18.11","Печатане на вестници"},
            {"18.12","Печатане на други издания и печатни продукти"},
            {"18.13","Предпечатна подготовка"},
            {"18.14","Подвързване и подобни дейности"},
            {"18.20","Възпроизвеждане на записани носители"},
            // 19 - Кокс и нефтопродукти
            {"19.10","Производство на кокс"},
            {"19.20","Производство на рафинирани нефтопродукти"},
            // 20 - Химични продукти
            {"20.11","Производство на промишлени газове"},
            {"20.12","Производство на багрила и пигменти"},
            {"20.13","Производство на основни неорганични химични вещества"},
            {"20.14","Производство на основни органични химични вещества"},
            {"20.15","Производство на азотни съединения и торове"},
            {"20.16","Производство на полимери в първични форми"},
            {"20.17","Производство на синтетичен каучук"},
            {"20.20","Производство на пестициди и агрохимикали"},
            {"20.30","Производство на бои, лакове и печатарско мастило"},
            {"20.41","Производство на сапун и миещи препарати"},
            {"20.42","Производство на парфюми и тоалетни продукти"},
            {"20.51","Производство на течни биогорива"},
            {"20.59","Производство на експлозиви, лепила и други химични продукти"},
            {"20.60","Производство на изкуствени и синтетични влакна"},
            // 21 - Лекарствени вещества
            {"21.10","Производство на лекарствени вещества"},
            {"21.20","Производство на лекарствени продукти"},
            // 22 - Каучук и пластмаси
            {"22.11","Производство на гуми"},
            {"22.12","Производство на други изделия от каучук"},
            {"22.21","Производство на листове, плочи, тръби от пластмаси"},
            {"22.22","Производство на опаковки от пластмаси"},
            {"22.23","Производство на врати и прозорци от пластмаси"},
            {"22.24","Производство на други изделия от пластмаси за строителството"},
            {"22.25","Довършителна обработка на изделия от пластмаси"},
            {"22.26","Производство на други изделия от пластмаси"},
            // 23 - Неметални минерални суровини
            {"23.11","Производство на необработено плоско стъкло"},
            {"23.12","Формуване и обработване на плоско стъкло"},
            {"23.13","Производство на опаковки и домакинско стъкло"},
            {"23.14","Производство на стъклени влакна"},
            {"23.15","Производство на други изделия от стъкло"},
            {"23.20","Производство на огнеупорни изделия"},
            {"23.31","Производство на керамични плочки"},
            {"23.32","Производство на тухли и керемиди"},
            {"23.41","Производство на домакински порцелан и керамика"},
            {"23.42","Производство на санитарна керамика"},
            {"23.43","Производство на керамични изолатори"},
            {"23.44","Производство на друга техническа керамика"},
            {"23.45","Производство на други керамични изделия"},
            {"23.51","Производство на цимент"},
            {"23.52","Производство на вар и гипс"},
            {"23.61","Производство на изделия от бетон за строителството"},
            {"23.62","Производство на изделия от гипс за строителството"},
            {"23.63","Производство на готови бетонови смеси"},
            {"23.64","Производство на неогнеупорни строителни разтвори"},
            {"23.65","Производство на влакнесто-циментови изделия"},
            {"23.66","Производство на други изделия от бетон, цимент и гипс"},
            {"23.70","Рязане и обработване на строителни скални материали"},
            {"23.91","Производство на абразивни изделия"},
            {"23.99","Производство на изделия от други неметални минерали"},
            // 24 - Основни метали
            {"24.10","Производство на чугун, стомана и феросплави"},
            {"24.20","Производство на тръби и профили от стомана"},
            {"24.31","Студено изтегляне на пръти"},
            {"24.32","Студено валцуване на тесни ленти"},
            {"24.33","Студено формуване на продукти от стомана"},
            {"24.34","Студено изтегляне на тел"},
            {"24.41","Производство на благородни метали"},
            {"24.42","Производство на алуминий"},
            {"24.43","Производство на олово, цинк, калай"},
            {"24.44","Производство на мед"},
            {"24.45","Производство на други цветни метали"},
            {"24.46","Преработка на ядрено гориво"},
            {"24.51","Леене на чугун"},
            {"24.52","Леене на стомана"},
            {"24.53","Леене на леки метали"},
            {"24.54","Леене на други метали"},
            // 25 - Метални изделия
            {"25.11","Производство на метални конструкции"},
            {"25.12","Производство на врати и прозорци от метал"},
            {"25.21","Производство на парни котли и радиатори"},
            {"25.22","Производство на цистерни и контейнери от метал"},
            {"25.30","Производство на въоръжение и боеприпаси"},
            {"25.40","Коване, щамповане и валцуване на метал"},
            {"25.51","Нанасяне на покритие върху метал"},
            {"25.52","Термично обработване на метал"},
            {"25.53","Механично обработване на метал"},
            {"25.61","Производство на кухненски прибори и ножарски изделия"},
            {"25.62","Производство на строителен и мебелен обков"},
            {"25.63","Производство на сечива и инструменти"},
            {"25.91","Производство на варели и подобни съдове"},
            {"25.92","Производство на леки опаковки от метал"},
            {"25.93","Производство на изделия от тел, вериги и пружини"},
            {"25.94","Производство на свързващи елементи"},
            {"25.99","Производство на други метални изделия"},
            // 26 - Компютърна и комуникационна техника
            {"26.11","Производство на електронни елементи"},
            {"26.12","Производство на монтирани печатни платки"},
            {"26.20","Производство на компютърна техника"},
            {"26.30","Производство на телекомуникационна техника"},
            {"26.40","Производство на битова електроника"},
            {"26.51","Производство на уреди за измерване и навигация"},
            {"26.52","Производство на часовници"},
            {"26.60","Производство на електромедицински апарати"},
            {"26.70","Производство на оптични уреди и фотографска техника"},
            // 27 - Електрически съоръжения
            {"27.11","Производство на електрически двигатели и трансформатори"},
            {"27.12","Производство на апарати за разпределение на ел. енергия"},
            {"27.20","Производство на акумулаторни батерии"},
            {"27.31","Производство на кабели от оптични влакна"},
            {"27.32","Производство на електрически проводници и кабели"},
            {"27.33","Производство на електроинсталационни изделия"},
            {"27.40","Производство на лампи и осветители"},
            {"27.51","Производство на битови електроуреди"},
            {"27.52","Производство на неелектрически битови уреди"},
            {"27.90","Производство на други електрически съоръжения"},
            // 28 - Машини и оборудване
            {"28.11","Производство на турбини и двигатели"},
            {"28.12","Производство на хидравлични помпи и двигатели"},
            {"28.13","Производство на други помпи и компресори"},
            {"28.14","Производство на арматурни изделия"},
            {"28.15","Производство на лагери, предавки и съединители"},
            {"28.21","Производство на пещи, горелки и отоплителни уреди"},
            {"28.22","Производство на подемно-транспортни машини"},
            {"28.23","Производство на офис техника"},
            {"28.24","Производство на преносими инструменти с вграден двигател"},
            {"28.25","Производство на промишлено климатично оборудване"},
            {"28.29","Производство на други машини с общо предназначение"},
            {"28.30","Производство на машини за селското и горското стопанство"},
            {"28.41","Производство на машини за обработване на метал"},
            {"28.42","Производство на други обработващи машини"},
            {"28.91","Производство на машини за металургията и леярството"},
            {"28.92","Производство на машини за добива и строителството"},
            {"28.93","Производство на машини за преработка на храни и напитки"},
            {"28.94","Производство на машини за текстил и облекло"},
            {"28.95","Производство на машини за хартия и картон"},
            {"28.96","Производство на машини за каучук или пластмаси"},
            {"28.99","Производство на други машини със специално предназначение"},
            // 29 - Автомобили
            {"29.10","Производство на автомобили и техните двигатели"},
            {"29.20","Производство на каросерии, ремаркета и полуремаркета"},
            {"29.31","Производство на електронни части за автомобили"},
            {"29.32","Производство на други части за автомобили"},
            // 30 - Превозни средства, без автомобили
            {"30.11","Строителство на граждански плавателни съдове"},
            {"30.12","Строителство на плавателни съдове за отдих"},
            {"30.20","Производство на локомотиви и вагони"},
            {"30.30","Производство на въздухоплавателни средства"},
            {"30.40","Производство на бойни бронирани машини"},
            {"30.91","Производство на мотоциклети"},
            {"30.92","Производство на велосипеди и инвалидни колички"},
            {"30.99","Производство на други превозни средства"},
            // 31 - Мебели
            {"31.00","Производство на мебели"},
            // 32 - Производство, некласифицирано другаде
            {"32.11","Сечене на монети"},
            {"32.12","Производство на бижутерийни изделия от благородни метали"},
            {"32.13","Производство на бижута имитация"},
            {"32.20","Производство на музикални инструменти"},
            {"32.30","Производство на спортни стоки"},
            {"32.40","Производство на игри и детски играчки"},
            {"32.50","Производство на медицински и зъболекарски инструменти"},
            {"32.91","Производство на метли и четки"},
            {"32.99","Други разнообразни производства"},
            // 33 - Ремонт и инсталиране на машини
            {"33.11","Ремонт на метални изделия"},
            {"33.12","Ремонт на машини и оборудване"},
            {"33.13","Ремонт на електронни и оптични уреди"},
            {"33.14","Ремонт на електрически съоръжения"},
            {"33.15","Ремонт на плавателни съдове"},
            {"33.16","Ремонт на въздухоплавателни средства"},
            {"33.17","Ремонт на други превозни средства"},
            {"33.19","Ремонт на друго оборудване"},
            {"33.20","Инсталиране на машини и оборудване"},
            // 35 - Енергия
            {"35.11","Производство на електрическа енергия от невъзобновяеми източници"},
            {"35.12","Производство на електрическа енергия от възобновяеми източници"},
            {"35.13","Пренос на електрическа енергия"},
            {"35.14","Разпределение на електрическа енергия"},
            {"35.15","Търговия с електрическа енергия"},
            {"35.21","Производство на газообразни горива"},
            {"35.22","Разпределение на газообразни горива"},
            {"35.23","Търговия с газообразни горива"},
            {"35.30","Производство и разпределение на топлинна енергия"},
            // 36-39 - Води и отпадъци
            {"36.00","Събиране, пречистване и доставяне на води"},
            {"37.00","Събиране, отвеждане и пречистване на отпадъчни води"},
            {"38.11","Събиране на неопасни отпадъци"},
            {"38.12","Събиране на опасни отпадъци"},
            {"38.21","Рециклиране на материали"},
            {"38.22","Изгаряне на отпадъци с получаване на енергия"},
            {"38.31","Изгаряне на отпадъци без получаване на енергия"},
            {"38.32","Депониране или постоянно съхранение на отпадъци"},
            {"39.00","Възстановяване и други дейности по управление на отпадъци"},
            // 41-43 - Строителство
            {"41.00","Строителство на жилищни и нежилищни сгради"},
            {"42.11","Строителство на автомагистрали и пътища"},
            {"42.12","Строителство на релсови пътища"},
            {"42.13","Строителство на мостове и тунели"},
            {"42.21","Строителство на преносни тръбопроводи"},
            {"42.22","Строителство на електрически и телекомуникационни мрежи"},
            {"42.91","Строителство на хидротехнически съоръжения"},
            {"42.99","Строителство на други съоръжения"},
            {"43.11","Събаряне и разрушаване"},
            {"43.12","Земни работи"},
            {"43.13","Сондиране и пробиване"},
            {"43.21","Изграждане на електрически инсталации"},
            {"43.22","Изграждане на ВиК, отоплителни и климатични инсталации"},
            {"43.23","Изграждане на изолация"},
            {"43.24","Изграждане на други инсталации"},
            {"43.31","Полагане на мазилки"},
            {"43.32","Монтаж на дограма и дърводелски работи"},
            {"43.33","Полагане на облицовки и настилки"},
            {"43.34","Боядисване и стъклопоставяне"},
            {"43.35","Други довършителни строителни дейности"},
            {"43.41","Покривни работи"},
            {"43.91","Зидарски и каменоделски дейности"},
            {"43.99","Други специализирани строителни дейности"},
            // 46 - Търговия на едро
            {"46.11","Търговско посредничество със селскостопански суровини"},
            {"46.12","Търговско посредничество с горива и метали"},
            {"46.13","Търговско посредничество с дървен материал"},
            {"46.14","Търговско посредничество с машини и оборудване"},
            {"46.15","Търговско посредничество с мебели и стоки за бита"},
            {"46.16","Търговско посредничество с текстил и облекло"},
            {"46.17","Търговско посредничество с хранителни стоки"},
            {"46.18","Търговско посредничество с други групи стоки"},
            {"46.19","Неспециализирано търговско посредничество"},
            {"46.21","Търговия на едро със зърно, семена и фуражи"},
            {"46.22","Търговия на едро с цветя и растения"},
            {"46.23","Търговия на едро с живи животни"},
            {"46.24","Търговия на едро със сурови и обработени кожи"},
            {"46.31","Търговия на едро с плодове и зеленчуци"},
            {"46.32","Търговия на едро с месо и риба"},
            {"46.33","Търговия на едро с мляко, яйца и масла"},
            {"46.34","Търговия на едро с напитки"},
            {"46.35","Търговия на едро с тютюневи изделия"},
            {"46.36","Търговия на едро със захар и захарни изделия"},
            {"46.37","Търговия на едро с кафе, чай и подправки"},
            {"46.38","Специализирана търговия на едро с други хранителни стоки"},
            {"46.39","Неспециализирана търговия на едро с хранителни стоки"},
            {"46.41","Търговия на едро с текстил"},
            {"46.42","Търговия на едро с облекло и обувки"},
            {"46.43","Търговия на едро с битова електроника"},
            {"46.44","Търговия на едро с порцелан и стъкларски изделия"},
            {"46.45","Търговия на едро с парфюмерия и козметика"},
            {"46.46","Търговия на едро с фармацевтични стоки"},
            {"46.47","Търговия на едро с мебели и килими"},
            {"46.48","Търговия на едро с часовници и бижутерия"},
            {"46.49","Търговия на едро с други нехранителни стоки"},
            {"46.51","Търговия на едро с компютри и софтуер"},
            {"46.52","Търговия на едро с електронни елементи и телекомуникационно оборудване"},
            {"46.61","Търговия на едро с машини за селското стопанство"},
            {"46.62","Търговия на едро с обработващи машини"},
            {"46.63","Търговия на едро с машини за добива и строителството"},
            {"46.64","Търговия на едро с други машини и оборудване"},
            {"46.71","Търговия на едро с горива"},
            {"46.72","Търговия на едро с метали и руди"},
            {"46.73","Търговия на едро с дървен материал и строителни материали"},
            {"46.74","Търговия на едро с железария"},
            {"46.75","Търговия на едро с химични продукти"},
            {"46.76","Търговия на едро с други междинни продукти"},
            {"46.77","Търговия на едро с отпадъци и скрап"},
            {"46.90","Неспециализирана търговия на едро"},
            // 47 - Търговия на дребно
            {"47.11","Търговия на дребно предимно с хранителни стоки"},
            {"47.19","Друга неспециализирана търговия на дребно"},
            {"47.21","Търговия на дребно с плодове и зеленчуци"},
            {"47.22","Търговия на дребно с месо и месни продукти"},
            {"47.23","Търговия на дребно с риба и морски храни"},
            {"47.24","Търговия на дребно с хляб и сладкарски изделия"},
            {"47.25","Търговия на дребно с напитки"},
            {"47.26","Търговия на дребно с тютюневи изделия"},
            {"47.29","Друга специализирана търговия на дребно с хранителни стоки"},
            {"47.30","Търговия на дребно с автомобилни горива"},
            {"47.41","Търговия на дребно с компютри и софтуер"},
            {"47.42","Търговия на дребно с телекомуникационно оборудване"},
            {"47.43","Търговия на дребно с аудио- и видеотехника"},
            {"47.51","Търговия на дребно с текстил"},
            {"47.52","Търговия на дребно с железария и строителни материали"},
            {"47.53","Търговия на дребно с тапети и подови покрития"},
            {"47.54","Търговия на дребно с битови електроуреди"},
            {"47.59","Търговия на дребно с мебели и други стоки за бита"},
            {"47.61","Търговия на дребно с книги"},
            {"47.62","Търговия на дребно с вестници и канцеларски стоки"},
            {"47.63","Търговия на дребно със спортни стоки"},
            {"47.64","Търговия на дребно с игри и играчки"},
            {"47.65","Търговия на дребно с други стоки за свободното време"},
            {"47.71","Търговия на дребно с облекло"},
            {"47.72","Търговия на дребно с обувки и кожени изделия"},
            {"47.73","Търговия на дребно с лекарства и фармацевтични стоки"},
            {"47.74","Търговия на дребно с медицински и ортопедични стоки"},
            {"47.75","Търговия на дребно с парфюмерия и козметика"},
            {"47.76","Търговия на дребно с цветя, растения и домашни любимци"},
            {"47.77","Търговия на дребно с часовници и бижутерия"},
            {"47.78","Търговия на дребно с други нехранителни стоки"},
            {"47.79","Търговия на дребно с употребявани стоки"},
            {"47.81","Търговия на дребно на сергии с хранителни стоки"},
            {"47.82","Търговия на дребно на сергии с текстил и облекло"},
            {"47.89","Търговия на дребно на сергии с други стоки"},
            {"47.91","Търговия на дребно чрез поръчки по пощата или интернет"},
            {"47.99","Друга търговия на дребно извън търговски обекти"},
            // 49 - Сухопътен транспорт
            {"49.10","Пътнически железопътен транспорт"},
            {"49.20","Товарен железопътен транспорт"},
            {"49.31","Пътнически градски и междуградски транспорт"},
            {"49.32","Пътнически таксиметров транспорт"},
            {"49.39","Друг пътнически сухопътен транспорт"},
            {"49.41","Товарен автомобилен транспорт"},
            {"49.42","Услуги по преместване"},
            {"49.50","Тръбопроводен транспорт"},
            // 50 - Воден транспорт
            {"50.10","Пътнически морски и крайбрежен транспорт"},
            {"50.20","Товарен морски и крайбрежен транспорт"},
            {"50.30","Пътнически транспорт по вътрешни водни пътища"},
            {"50.40","Товарен транспорт по вътрешни водни пътища"},
            // 51 - Въздушен транспорт
            {"51.10","Пътнически въздушен транспорт"},
            {"51.21","Товарен въздушен транспорт"},
            // 52 - Складиране
            {"52.10","Складиране и съхраняване на товари"},
            {"52.21","Експлоатация на инфраструктурата в сухопътния транспорт"},
            {"52.22","Спомагателни дейности във водния транспорт"},
            {"52.23","Спомагателни дейности във въздушния транспорт"},
            {"52.24","Обработка на товари"},
            {"52.29","Други спомагателни дейности в транспорта"},
            // 53 - Пощенски и куриерски дейности
            {"53.10","Дейност на пощи, предоставящи универсална пощенска услуга"},
            {"53.20","Други пощенски и куриерски дейности"},
            // 55 - Хотелиерство
            {"55.10","Хотели и подобни места за настаняване"},
            {"55.20","Туристическо и друго краткосрочно настаняване"},
            {"55.30","Къмпинги и терени за каравани"},
            {"55.90","Други места за настаняване"},
            // 56 - Ресторантьорство
            {"56.10","Дейност на ресторанти и заведения за бързо обслужване"},
            {"56.21","Приготвяне и доставяне на храна по конкретен повод"},
            {"56.29","Други дейности по приготвяне и доставяне на храна"},
            {"56.30","Дейност на питейни заведения"},
            // 58 - Издателска дейност
            {"58.11","Издаване на книги"},
            {"58.12","Издаване на вестници"},
            {"58.13","Издаване на списания и периодични издания"},
            {"58.19","Друга издателска дейност"},
            {"58.21","Издаване на видеоигри"},
            {"58.29","Издаване на други програмни продукти"},
            // 59 - Филми и звукозаписване
            {"59.11","Производство на филми и телевизионни предавания"},
            {"59.12","Технически дейности при производство на филми"},
            {"59.13","Разпространение на филми и предавания"},
            {"59.14","Прожектиране на филми"},
            {"59.20","Звукозаписване и издаване на музика"},
            // 60 - Радио и телевизия
            {"60.10","Създаване и излъчване на радиопрограми"},
            {"60.20","Създаване и излъчване на телевизионни програми"},
            // 61 - Далекосъобщения
            {"61.10","Телекомуникационна дейност чрез фиксирани и безжични мрежи"},
            {"61.20","Дейности по препродажба на телекомуникационни услуги"},
            {"61.90","Други телекомуникационни дейности"},
            // 62 - Информационни технологии
            {"62.10","Компютърно програмиране"},
            {"62.20","Консултантска дейност по ИТ"},
            {"62.90","Други дейности в областта на ИТ"},
            // 63 - Информационни услуги
            {"63.10","Обработка на данни, хостинг и подобни дейности"},
            {"63.91","Дейности на информационни агенции"},
            {"63.99","Други информационни услуги"},
            // 64 - Финансови услуги
            {"64.11","Дейност на централната банка"},
            {"64.19","Друго парично посредничество"},
            {"64.20","Дейност на холдингови дружества"},
            {"64.30","Дейност на фондове"},
            {"64.91","Финансов лизинг"},
            {"64.92","Други форми на предоставяне на кредит"},
            {"64.99","Предоставяне на други финансови услуги"},
            // 65 - Застраховане
            {"65.11","Животозастраховане"},
            {"65.12","Друго застраховане, без животозастраховане"},
            {"65.20","Презастраховане"},
            {"65.30","Допълнително пенсионно осигуряване"},
            // 66 - Спомагателни финансови дейности
            {"66.11","Управление на финансови пазари"},
            {"66.12","Посредническа дейност по сделки с ценни книжа"},
            {"66.19","Други спомагателни дейности във финансовите услуги"},
            {"66.21","Оценяване на застрахователни рискове и щети"},
            {"66.22","Дейности на застрахователни брокери и агенти"},
            {"66.29","Спомагателни дейности в застраховането"},
            {"66.30","Управление на фондове"},
            // 68 - Недвижими имоти
            {"68.10","Покупка и продажба на собствени недвижими имоти"},
            {"68.20","Даване под наем на собствени недвижими имоти"},
            {"68.31","Посреднически дейности при операции с недвижими имоти"},
            {"68.32","Управление на недвижими имоти срещу възнаграждение"},
            // 69 - Юридически и счетоводни дейности
            {"69.10","Юридически дейности"},
            {"69.20","Счетоводни и одиторски дейности; данъчни консултации"},
            // 70 - Централни офиси и управленско консултиране
            {"70.10","Дейност на централни офиси"},
            {"70.20","Консултантски дейности по стопанско управление"},
            // 71 - Архитектурни и инженерни дейности
            {"71.11","Архитектурни дейности"},
            {"71.12","Инженерни дейности и технически консултации"},
            {"71.20","Технически изпитвания и анализи"},
            // 72 - Научноизследователска дейност
            {"72.11","Научни изследвания в областта на естествените и техническите науки"},
            {"72.19","Други научни изследвания в областта на естествените науки"},
            {"72.20","Научни изследвания в областта на обществените и хуманитарните науки"},
            // 73 - Рекламна дейност
            {"73.11","Дейност на рекламни агенции"},
            {"73.12","Дейности по продажба на медийно време и място за реклама"},
            {"73.20","Проучване на пазари и изследване на общественото мнение"},
            // 74 - Други професионални дейности
            {"74.10","Дейности в областта на дизайна"},
            {"74.20","Дейности в областта на фотографията"},
            {"74.30","Преводаческа дейност"},
            {"74.90","Други професионални дейности"},
            // 75 - Ветеринарна дейност
            {"75.00","Ветеринарномедицинска дейност"},
            // 77 - Даване под наем и оперативен лизинг
            {"77.11","Даване под наем на леки автомобили"},
            {"77.12","Даване под наем на тежкотоварни автомобили"},
            {"77.21","Даване под наем на оборудване за спорт и развлечения"},
            {"77.22","Даване под наем на видеокасети и дискове"},
            {"77.29","Даване под наем на други лични и домакински вещи"},
            {"77.31","Даване под наем на машини за селското стопанство"},
            {"77.32","Даване под наем на машини за строителството"},
            {"77.33","Даване под наем на офис мебели и компютри"},
            {"77.34","Даване под наем на плавателни съдове"},
            {"77.35","Даване под наем на въздухоплавателни средства"},
            {"77.39","Даване под наем на други машини и оборудване"},
            {"77.40","Оперативен лизинг на интелектуална собственост"},
            // 78 - Наемане на работна сила
            {"78.10","Посредническа дейност на агенции по наемане на работа"},
            {"78.20","Предоставяне на работна сила за временна заетост"},
            // 79 - Туристическа дейност
            {"79.11","Туристическа агентска дейност"},
            {"79.12","Туроператорска дейност"},
            {"79.90","Други дейности, свързани с пътувания и резервации"},
            // 80 - Охрана и разследване
            {"80.10","Частна охранителна дейност без използване на технически системи"},
            {"80.20","Дейности по охрана с технически системи за сигурност"},
            {"80.30","Дейности по разследване"},
            // 81 - Обслужване на сгради
            {"81.10","Комплексно обслужване на сгради"},
            {"81.21","Неспециализирано вътрешно почистване на сгради"},
            {"81.22","Специализирано почистване на сгради"},
            {"81.29","Други дейности по почистване"},
            {"81.30","Оформяне и поддържане на озеленени площи"},
            // 82 - Административни офис дейности
            {"82.11","Комплексни административни офис услуги"},
            {"82.19","Размножаване, подготовка на документи и друга офис дейност"},
            {"82.20","Дейности на телефонни центрове"},
            {"82.30","Организиране на конгреси и търговски изложения"},
            {"82.91","Дейности по събиране на парични вземания"},
            {"82.92","Дейности по опаковане и пакетиране"},
            {"82.99","Друго спомагателно обслужване на стопанската дейност"},
            // 84 - Държавно управление
            {"84.11","Общофункционално управление на държавата"},
            {"84.12","Държавно управление в областта на здравеопазването и образованието"},
            {"84.13","Държавно управление в областта на стопанската дейност"},
            {"84.21","Външни работи"},
            {"84.22","Отбрана"},
            {"84.23","Правосъдие"},
            {"84.24","Обществен ред и сигурност"},
            {"84.25","Пожарна безопасност и защита при бедствия"},
            {"84.30","Държавно обществено осигуряване"},
            // 85 - Образование
            {"85.10","Предучилищно образование"},
            {"85.20","Начално образование"},
            {"85.31","Общо средно образование"},
            {"85.32","Професионално средно образование"},
            {"85.41","Висше образование - бакалавър и магистър"},
            {"85.42","Висше образование - докторат"},
            {"85.51","Обучение в областта на спорта и активния отдих"},
            {"85.52","Обучение в областта на културата"},
            {"85.53","Обучение на водачи на превозни средства"},
            {"85.59","Други образователни дейности"},
            {"85.60","Спомагателни дейности в областта на образованието"},
            // 86 - Хуманно здравеопазване
            {"86.10","Дейност на болници"},
            {"86.21","Дейност на общопрактикуващи лекари"},
            {"86.22","Дейност на лекари специалисти"},
            {"86.23","Дейност на лекари по дентална медицина"},
            {"86.90","Други дейности по хуманно здравеопазване"},
            // 87 - Медико-социални грижи с настаняване
            {"87.10","Дейност на заведения със здравни грижи"},
            {"87.20","Социални грижи с настаняване за лица с психични заболявания"},
            {"87.30","Социални грижи с настаняване за възрастни и хора с увреждания"},
            {"87.90","Други социални грижи с настаняване"},
            // 88 - Социална работа без настаняване
            {"88.10","Социална работа без настаняване за възрастни и хора с увреждания"},
            {"88.91","Дневни грижи за малки деца"},
            {"88.99","Друга социална работа без настаняване"},
            // 90 - Артистична и творческа дейност
            {"90.01","Изпълнителско изкуство"},
            {"90.02","Спомагателни дейности в изпълнителското изкуство"},
            {"90.03","Творческа дейност в областта на изкуствата"},
            {"90.04","Експлоатация на зали за представления"},
            // 91 - Култура
            {"91.01","Дейност на библиотеки и архиви"},
            {"91.02","Дейности на музеи"},
            {"91.03","Опазване на исторически паметници и сгради"},
            {"91.04","Дейност на ботанически и зоологически градини и природни резервати"},
            // 92 - Хазартни игри
            {"92.00","Организиране на хазартни игри"},
            // 93 - Спортни и развлекателни дейности
            {"93.11","Експлоатация на спортни обекти и съоръжения"},
            {"93.12","Дейност на спортни клубове"},
            {"93.13","Дейност на фитнес центрове и зали"},
            {"93.19","Други дейности в областта на спорта"},
            {"93.21","Дейност на увеселителни и тематични паркове"},
            {"93.29","Други дейности, свързани с развлечения и отдих"},
            // 94 - Организации с нестопанска цел
            {"94.11","Дейност на бизнес организации и организации на работодатели"},
            {"94.12","Дейност на професионални организации"},
            {"94.20","Дейност на синдикални организации"},
            {"94.91","Дейност на религиозни организации"},
            {"94.92","Дейност на политически организации"},
            {"94.99","Дейност на други организации с нестопанска цел"},
            // 95 - Ремонт на компютърна техника и битови уреди
            {"95.11","Ремонт на компютри и периферно оборудване"},
            {"95.12","Ремонт на телекомуникационно оборудване"},
            {"95.21","Ремонт на битова електроника"},
            {"95.22","Ремонт на битови електроуреди"},
            {"95.23","Поправка на обувки и кожени изделия"},
            {"95.24","Ремонт на мебели и предмети за обзавеждане"},
            {"95.25","Ремонт на часовници и бижута"},
            {"95.29","Ремонт на други лични и домакински вещи"},
            // 96 - Други персонални услуги
            {"96.01","Пране и химическо чистене"},
            {"96.02","Фризьорски и козметични услуги"},
            {"96.03","Организиране на погребения и свързани услуги"},
            {"96.04","Поддържане на добро физическо състояние"},
            {"96.09","Други персонални услуги, некласифицирани другаде"},
            // 97-99
            {"97.00","Дейности на домакинства като работодатели на домашен персонал"},
            {"98.10","Недиференцирани дейности на домакинства по производство на стоки"},
            {"98.20","Недиференцирани дейности на домакинства по производство на услуги"},
            {"99.00","Дейности на екстериториални организации и служби"},
        };

        List<EconomicActivity> result = new ArrayList<>();
        for (String[] row : data) {
            EconomicActivity a = new EconomicActivity();
            a.setTenantId(tenantId);
            a.setYear(year);
            a.setCode(row[0]);
            a.setName(row[1]);
            a.setTzpbPercent(getTzpbByKidCode(row[0]));
            result.add(economicActivityRepository.save(a));
        }
        return result;
    }

    public void importMod(String tenantId, int year, MultipartFile file) throws IOException {
        List<EconomicActivity> activities = parseModCsv(new BufferedReader(new InputStreamReader(file.getInputStream(), StandardCharsets.UTF_8)), year);
        for (EconomicActivity activity : activities) {
            activity.setTenantId(tenantId);
            economicActivityRepository.save(activity);
        }
    }
    
    public void importModFromFileSystem(String tenantId, int year, java.io.InputStream inputStream) throws IOException {
         List<EconomicActivity> activities = parseModCsv(new BufferedReader(new InputStreamReader(inputStream, StandardCharsets.UTF_8)), year);
         for (EconomicActivity activity : activities) {
            activity.setTenantId(tenantId);
            economicActivityRepository.save(activity);
        }
    }

    private List<EconomicActivity> parseModCsv(BufferedReader reader, int year) throws IOException {
        List<EconomicActivity> activities = new ArrayList<>();
        String line;
        boolean isFirstLine = true;

        while ((line = reader.readLine()) != null) {
            if (line.trim().isEmpty()) continue;
            
            if (isFirstLine) {
                 if (line.contains("Red") || line.contains("KID_Code")) {
                     isFirstLine = false;
                     continue;
                 }
                 isFirstLine = false;
            }

            // CSV Parsing (comma separated, handles quotes)
            String[] parts = line.split(",(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)");

            if (parts.length >= 5) {
                EconomicActivity activity = new EconomicActivity();
                activity.setYear(year);
                activity.setCode(parts[1].trim());

                String name = parts[2].trim();
                if (name.startsWith("\"") && name.endsWith("\"")) {
                    name = name.substring(1, name.length() - 1);
                }
                activity.setName(name);

                try {
                    activity.setModAmount(new BigDecimal(parts[3].trim()));
                    
                    String tzpbStr = parts[4].trim();
                    if (tzpbStr.endsWith("%")) {
                        tzpbStr = tzpbStr.substring(0, tzpbStr.length() - 1);
                    }
                    activity.setTzpbPercent(new BigDecimal(tzpbStr));
                } catch (NumberFormatException e) {
                    continue; 
                }

                activities.add(activity);
            }
        }
        return activities;
    }
}
